import { createClient } from '@/lib/client';  // Adjust the import path based on your project structure
import { serverAction } from 'next/server';  // Ensure you're using Next.js's server action helper

const client = createClient();  // Create Sanity client

// Define the server action to handle form submission
export const handleFormSubmission = serverAction(async (formData: any) => {
  try {
    // Create the candidat document object based on the form data
    const candidatDocument = {
      _type: 'candidat',  // The type name should match your Sanity schema (e.g., "candidat")
      nom: formData.nom,  // Correspond to 'nom' in your schema
      email: formData.email,  // Correspond to 'email' in your schema
      entreprise: formData.entreprise,  // Correspond to 'entreprise' in your schema
      projet: formData.projet,  // Correspond to 'projet' in your schema
      cv: formData.files?.map((file: File) => ({
        _type: 'file',
        asset: {
          _type: 'reference',
          _ref: file.id,  // Assuming file.id is returned by the file upload
        },
      })) || [],  // Handle files if they exist
    };

    // Use the Sanity client to create the document
    const result = await client.create(candidatDocument);

    return {
      success: true,
      message: 'Form submitted successfully and data saved to Sanity!',
      result,
    };
  } catch (error) {
    return {
      success: false,
      message: 'Error submitting form',
      error: error.message,
    };
  }
});
